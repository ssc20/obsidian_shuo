
[Enhance PDF : r/pdf](https://www.reddit.com/r/pdf/comments/11c1zn3/enhance_pdf/)
#pdf
There are a few tools that can help. but I don't know of any that is perfect. The best results are achieved by combining their strengths, which unfortunately requires manual effort still.

These are the tools I found to be best (when I researched how to process scanned sheetmusic and B/W books):

- Extract scanned images from existing PDFs losslessly with `pdfimages -tiff`
    
- Some PDFs have weird image compression and need special treatment, for example those generated by "LuraDocument PDF Compressor". In this case, use `pdfimages -list` to gather final output DPI, followed by `convert -density $DPI +antialias` to extract.
    
- Crop dark borders with `convert`
    
- For automatic despeckle, use `unpaper`
    
- When using a flatbed scanner, an empty page can be scanned to generate a "dustmask", and then apply it to "de-dust" all pages with `convert -morphology` to select the dust and `cv2.INPAINT_TELEA` to generate the new pixels. It's a bit complex, but I can elaborate if necessary.
    
- For automatic rotation of skewed pages, I found that Fred Weinhaus' TEXTDESKEW script works best for text, while `unpaper` works ok-ish for mixed inputs. For sheetmusic specifically, both are shitty because music often has intentionally skewed runs. In this case I delete the music content with `convert -morphology` and then do trial rotation on the now empty (and always horizontal) stafflines.
    
- To register the pages, `unpaper` is great at creating a textual description of where the content of each page is. This data needs some custom processing to decide on the final placement. `convert` is best to apply the placement. The best way to judge the page placement is to look at a composite stack of all pages with transparency, generated using a loop with `convert -compose darken -composite` (and progressively adapted alpha).
    
- If the input contains halftone greyscale pictures, you need to re-generate the dithering pattern now. Use `convert -gaussian-blur ... -level ... -ordered-dither ...` for this, but be sure to apply a mask first to not affect the rest of the page.
    
- Go from gray scale to B/W with `convert -level`, then use `convert --threshold 60% -type bilevel -monochrome -depth 1` to get a true bilevel bitmap. Compress it losslessly with `tiffcp -c g4`.
    
- At this point, either generate a lossless PDF with `tiff2pdf`. Or improve compression further using `jbig2enc -s -t 0.9 -p`. This works best for books with lots of text.
    
- Enable text search with `ocrmypdf --output-type=pdf`
    
- Post-process with `mutool clean -g -g -g` and `pdfsizeopt --use-jbig2=no --use-pngout=no --do-optimize-images=no --do-require-image-optimizers=no`
    

The result of this are PDFs that are extraordinarily clean and nice to view and print, while also extremly small despite high DPI (400, 600, or more). A page of sheetmusic is below 50KB, music combined with B/W illustrations still below 100KB. Books with mostly text go at 20-40KB per page. Note that I try to preserve the input quality as much as possible. If you decide not to rotate, not to despeckle, not to use JBIG2, etc, the processing chain can output exactly the same pixels as the input had.

I made scripts for all of this, but they are not polished. If you (or someone else) are honestly interested about using these methods and need help, or want to publish a more accessible tool based on them, contact me.